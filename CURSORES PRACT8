CREATE TABLE TRABAJADOR(SEGURO INTEGER PRIMARY KEY,NOMBRE VARCHAR(25),EDAD INTEGER);

CREATE TABLE NOMINA(ID_NOMINA INTEGER,SEGURO INTEGER, SUELDO_BASE FLOAT,
HORAS_LABORADAS INTEGER,FECHA_PAGO DATE, 
CONSTRAINT PK_ID_NOMINA PRIMARY KEY(ID_NOMINA),CONSTRAINT FK1_SEGURO FOREIGN KEY(SEGURO)REFERENCES
TRABAJADOR(SEGURO));

CREATE SEQUENCE SEC_NOMINA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE PROCEDURE GUARDAR_NOMINA(MY_ID_NOMINA OUT INTEGER,
MY_SEGURO IN INTEGER,MY_SUELDO_BASE IN INTEGER)AS 
BEGIN

SELECT SEC_NOMINA.NEXTVAL INTO MY_ID_NOMINA FROM DUAL;
INSERT INTO NOMINA(ID_NOMINA, SEGURO,SUELDO_BASE)
VALUES(MY_ID_NOMINA,
MY_SEGURO,MY_SUELDO_BASE);
END;
/

CREATE OR REPLACE PROCEDURE GENERAR_TRABAJADOR(MY_SEGURO IN INTEGER,MY_NOMBRE
IN VARCHAR2,MY_EDAD IN INTEGER,
MY_ID_NOMINA OUT INTEGER,MY_SUELDO_BASE IN FLOAT) AS 
BEGIN
INSERT INTO TRABAJADOR VALUES(MY_SEGURO,MY_NOMBRE,MY_EDAD);
GUARDAR_NOMINA(MY_ID_NOMINA,MY_SEGURO,MY_SUELDO_BASE);

END;
/

--GUARDAR E INVOCAR EL PROCEDIMIENTO
DECLARE 
VALOR INTEGER;
BEGIN

GENERAR_TRABAJADOR(2,'PEDRO',40,VALOR,8000);
GENERAR_TRABAJADOR(3,'JUAN',35,VALOR,7000);
GENERAR_TRABAJADOR(4,'KARLA',41,VALOR,10000);

END;
/


---UPDATE NOMINA SET HORAS_LABORADAS=WHERE SEGURO;


select * from trabajador;
select * from nomina;

--estructura de un cursor basico 

DECLARE
CURSOR CU_1 IS SELECT* FROM TRABAJADOR;
BEGIN
FOR GATO IN CUR_1 LOOP
DBMS_OUTPUT.PUT_LINE('NOMBRE'||GATO.NOMBRE||,'EDAD'||GATO.EDAD);
END LOOP;
END;
/
SET SERVEROUTPUT ON;


CURSOR CU_2 IS SELECT*FROM NOMINA;
NOMBRE VARCHAR2(40);
EDAD INTEGER;
SUELDO INTEGER;




DECLARE
CURSOR CUR_1 IS SELECT*FROM TRABAJADOR;
CURSOR CUR_2 IS SELECT*FROM NOMINA;

BEGIN
FOR GATO IN CUR_1 LOOP
FOR PERRO IN CUR_2 LOOP
IF PERRO.SEGURO=GATO.SEGURO THEN
DBMS_OUTPUT.PUT_LINE('NOMBRE'||GATO.NOMBRE||'SUELDO'||PERRO.SUELDO_BASE );
--LOGIC
END IF;

END LOOP;
END LOOP;
END;
/


SELECT * FROM NOMINA;



---CURSORES CON UPDATE--

----JOIN RELACIONA DOS TABLAS 
--INSERT HACE CONSULTAS
---UPDATE-
---EN LOS CURSORES SI HAY CAMBIO EN LA BASE DE DATOS


DECLARE
CURSOR CUR_3 IS SELECT * FROM NOMINA FOR UPDATE;
BEGIN
FOR REC IN CUR_3 LOOP
UPDATE NOMINA SET HORAS_LABORADAS=40 WHERE CURRENT OF CUR_3;
END LOOP;
END;
/

SELECT * FROM NOMINA;
